@{
    ViewData["Title"] = "Cấu hình trang";
    Layout = "~/Areas/Admin/Views/Shared/_ViewAdmin.cshtml";
}
@section Scripts {
    <script>
        var files;
        var myScripts = {
            init: function () {
                myScripts.LoadDetail();
                myScripts.Event();
            },

            Event: function () {
                $("#btnSaveData").off("click").on("click", function () {
                    myScripts.SaveData();
                });

                $("#btnRemoveUpload").off("click").on("click", function () {
                    $("#isThayDoi").val("true");
                    $('#imageHoSo').attr('src', '/root/unnamed.png');
                });

                $("#btnUpload").off('click').on('click', function () {
                    $("#duong_dan_file").click();
                    $("#duong_dan_file").off('change').on('change', function (e) {
                        files = e.target.files;
                        if (files.length > 0) {
                            for (var x = 0; x < files.length; x++) {
                                if (files[x].size >= 52428800) {
                                    toastr.error("Chỉ được upload file dưới 50mb", "Lỗi", { showMethod: "slideDown", hideMethod: "slideUp", timeOut: 1000 });
                                    $("#isThayDoi").val("false");
                                    return;
                                } else {
                                    myScripts.readURL(this);
                                    $("#isThayDoi").val("true");
                                }
                            }
                        }
                    });
                });
            },

            LoadDetail: function () {
                    $.ajax({
                        url: '/Admin/SeoInfomation/LoadDetail',
                        type: "GET",
                        dataType: "json",
                        success: function (response) {
                            if (response.status == true) {
                                var lstData = response.lstData;
                                if (lstData != null) {
                                    $("#Email").val(lstData.email);
                                    $("#TenToChuc").val(lstData.tenToChuc);
                                    $("#SoDienThoai").val(lstData.soDienThoai);
                                    $("#ChucVu").val(lstData.chucVu);
                                    $("#MaSoThue").val(lstData.maSoThue);
                                    $("#NoiCapMst").val(lstData.noiCapMst);
                                    $("#DiaChiDoanhNghiep").val(lstData.diaChiDoanhNghiep);
                                    $("#Ho").val(lstData.ho);
                                    $("#TenDem").val(lstData.tenDem);
                                    $("#Ten").val(lstData.ten);
                                    $("#PasswordHash").val(lstData.passwordHash);

                                    if (lstData.urlTaiLieu != null && lstData.urlTaiLieu != "") {
                                        $('#imageHoSo').attr('src', lstData.urlTaiLieu);
                                    } else {
                                        $('#imageHoSo').attr('src', '');
                                    }
                                    $("#isThayDoi").val("false");
                                }
                            } else {
                                toastr.error(response.message, "Lỗi", { showMethod: "slideDown", hideMethod: "slideUp", timeOut: 1000 });
                            }
                        }
                    })

            },

            readURL: function (input) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#imageHoSo').attr('src', e.target.result);
                }
                reader.readAsDataURL(input.files[0]);
            },
            
            SaveData: function () {
                var Email = $("#Email").val();
                var TenToChuc = $("#TenToChuc").val();
                var SoDienThoai = $("#SoDienThoai").val();
                var DiaChiDoanhNghiep = $("#DiaChiDoanhNghiep").val();
                var ChucVu = $("#ChucVu").val();
                var MaSoThue = $("#MaSoThue").val();
                var NoiCapMst = $("#NoiCapMst").val();
                var Ho = $("#Ho").val();
                var TenDem = $("#TenDem").val();
                var Ten = $("#Ten").val();
                var PasswordHash = $("#PasswordHash").val();
             
                var objdata = {
                    Email: Email,
                    TenToChuc: TenToChuc,
                    SoDienThoai: SoDienThoai,
                    DiaChiDoanhNghiep:DiaChiDoanhNghiep,
                    ChucVu: ChucVu,
                    MaSoThue: MaSoThue,
                    NoiCapMst: NoiCapMst,
                    Ho: Ho,
                    TenDem: TenDem,
                    Ten: Ten,
                    PasswordHash: PasswordHash,
                }
                if (files != undefined && files.length > 0) {
                    if (window.FormData !== undefined) {
                        var data = new FormData();
                        for (var x = 0; x < files.length; x++) {
                            data.append('files', files[x]);

                        }
                        data.append("strData", JSON.stringify(objdata));
                        data.append('isThayDoi', $("#isThayDoi").val());

                        $.ajax({
                            type: "POST",
                            url: '/Admin/SeoInfomation/SaveData',
                            contentType: false,
                            processData: false,
                            data: data,
                            success: function (response) {
                                if (response.status == true) {
                                    toastr.success("Cập nhập thành công", "Thành Công", { showMethod: "slideDown", hideMethod: "slideUp", timeOut: 1000 });
                                    myScripts.LoadTable();
                                } else {
                                    notify('error', 'Có Lỗi', response.message);
                                }
                            },
                            error: function (response) {
                                toastr.error(response.message, "Lỗi", { showMethod: "slideDown", hideMethod: "slideUp", timeOut: 1000 });
                            }
                        });
                    } else {
                        alert("Upload file thất bại!");
                    }
                }
                else {
                    $.ajax({
                        type: 'Post',
                        url: '/Admin/SeoInfomation/SaveData',
                        datatype: 'json',
                        data: {
                            strData: JSON.stringify(objdata),
                        },
                        success: function (response) {
                            if (response.status) {
                                toastr.success("Cập nhập thành công", "Thành Công", { showMethod: "slideDown", hideMethod: "slideUp", timeOut: 1000 });
                                myScripts.LoadDetail();
                            }
                            else {
                                toastr.error(response.message, "Lỗi", { showMethod: "slideDown", hideMethod: "slideUp", timeOut: 1000 });
                            }
                        },
                    });
                }
            },
        };
        myScripts.init();
    </script>
}
<style>
    .space-between {
        display: flex;
        justify-content: space-between;
        cursor: pointer;
        font-size: 1.2rem;
    }
</style>
<div class="card">
    <div class="card-header p-2 bg-dark-admin d-flex align-items-center">
        <h4 class="card-title text-white mb-0 fs-3">Thông tin cấu hình trang</h4>
    </div>
    <form class="form-horizontal">
        <div class="form-body card-form-body">
            <div class="p-0">
                <div class="row">
                    <div class="col-lg-12 d-flex align-items-stretch p-0">
                        <div class="card w-100 border position-relative m-0 overflow-hidden">
                            <div class="card-body p-3 pt-0">
                                <div class="form-group">
                                    <div class="row">
                                        <input type="hidden" id="IdTaiKhoan" name="name" value="" />
                                        <div class="col-sm-12 row">
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Email:</label>
                                                <input type="text" class="form-control" placeholder="" id="Email" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Hotline:</label>
                                                <input type="text" class="form-control" placeholder="" id="TenToChuc" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Điện thoại:</label>
                                                <input type="number" class="form-control" placeholder="" id="SoDienThoai" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Zalo:</label>
                                                <input type="text" class="form-control" placeholder="" id="ChucVu" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Facebook:</label>
                                                <input type="text" class="form-control" placeholder="" id="MaSoThue" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Website:</label>
                                                <input type="text" class="form-control" placeholder="" id="NoiCapMst" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Fanpage:</label>
                                                <input type="text" class="form-control" placeholder="" id="DiaChiDoanhNghiep" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Tọa độ google map:</label>
                                                <input type="text" class="form-control" placeholder="" id="Ho" value="">
                                            </div>
                                            <div class="col-sm-4 mb-2">
                                                <label class="fs-2 form-label m-0">Link google maps:</label>
                                                <input type="text" class="form-control" placeholder="" id="TenDem" value="">
                                            </div>
                                            <div class="col-sm-12 mb-2">
                                                <label class="fs-2 form-label m-0">Địa chỉ phòng khám:</label>
                                                <input type="text" class="form-control" placeholder="" id="Ten" value="">
                                            </div>
                                        </div>
                                        <div class="col-sm-12 row">
                                            <div class="col-sm-12 d-flex align-items-stretch" style="height: max-content;">
                                                <div class="card w-100 border position-relative overflow-hidden m-0">
                                                    <div class="card-body p-2">
                                                        <label class="fs-2 form-label m-0">Ảnh quảng cáo:</label>
                                                        <div class="text-center">
                                                            <img src="" id="imageHoSo" class="" width="100%" height="250px">
                                                            <input type="file" id="duong_dan_file" name="name" value="" hidden />
                                                            <input type="text" id="isThayDoi" hidden />
                                                            <div class="d-flex space-between my-1 gap-1">
                                                                <a class="text-danger" id="btnRemoveUpload"><i class="ti ti-trash"></i></a>
                                                                <a class="text-primary" id="btnUpload"><i class="ti ti-upload"></i> </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12">
                                            <div class="col-sm-12">
                                                <label class="fs-2 form-label m-0">Tọa độ google map iframe: <a href="https://www.google.com/maps">(Lấy mã nhúng)</a> </label>
                                                <textarea type="text" class="form-control" rows="6" rows="2" placeholder="<iframe ..." id="PasswordHash" value=""></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-actions border-top">
                <div class="card-footer card-footer-form text-end p-2">
                    <div class="col-md-12">
                        <div class="row ">
                            <div class="col-md-offset-3 col-md-12 text-right">
                                <button type="button" id="btnSaveData" class="btn btn-primary">
                                    <i class="ti ti-edit fs-5"></i>
                                    Lưu dữ liệu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
